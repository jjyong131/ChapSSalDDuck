<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>찰떡궁합 로테이션 소개팅 - 사전 신청</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4018LH294V"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4018LH294V');
    </script>
    <style>
        /* CSS 스타일은 이전과 동일합니다 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body{font-family:'Noto Sans KR',sans-serif;background-color:#fce4ec;display:flex;justify-content:center;align-items:center;padding:40px 0;min-height:100vh;color:#333;word-break:keep-all}.container{background-color:white;padding:40px 50px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,0.1);text-align:center;max-width:600px;width:90%}h1{color:#d81b60;font-size:2.2em;font-weight:900;margin-bottom:20px;line-height:1.4}.catchphrase{font-size:1.1em;color:#555;margin-bottom:25px;font-style:italic;line-height:1.6}.hook-text{font-size:1.2em;line-height:1.7;margin-bottom:25px;font-weight:bold}.event-announcement{font-size:1.5em;font-weight:700;color:#fff;background:linear-gradient(45deg,#ec407a,#d81b60);padding:15px 20px;border-radius:15px;display:inline-block;margin-bottom:30px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}.description{font-size:1.1em;line-height:1.7;margin-bottom:30px;text-align:left;background-color:#f9f9f9;padding:20px;border-radius:10px}.event-details{text-align:left;border:2px dashed #f8bbd0;padding:20px;border-radius:10px;margin-bottom:30px}.event-details h2{text-align:center;color:#d81b60;margin-top:0;font-size:1.5em}.event-details p{font-size:1.1em;margin:10px 0;line-height:1.6}.event-details p strong{display:inline-block;width:60px}.final-info{font-size:0.8em;color:#777;margin-top:20px;line-height:1.7}.cta-button{background:linear-gradient(45deg,#ec407a,#d81b60);color:white;border:none;padding:15px 30px;font-size:1.3em;font-weight:bold;border-radius:30px;cursor:pointer;transition:all .3s ease;box-shadow:0 5px 15px rgba(216,27,96,0.4);margin-top:20px}.cta-button:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(216,27,96,0.5)}.modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.5)}.modal-content{background-color:#fefefe;margin:10% auto;padding:30px;border:1px solid #888;width:80%;max-width:400px;border-radius:15px;text-align:center;position:relative}.close-btn{color:#aaa;position:absolute;top:10px;right:20px;font-size:28px;font-weight:bold;cursor:pointer}input,select{width:calc(100% - 24px);padding:12px;margin:8px 0;border:1px solid #ddd;border-radius:8px;font-size:1em;font-family:'Noto Sans KR',sans-serif}@media (max-width:768px){body{padding:20px 0;align-items:flex-start}.container{width:90%;padding:30px 20px;box-shadow:none}h1{font-size:1.8em}.event-announcement{font-size:1.0em}.hook-text,.catchphrase,.description,.event-details p{font-size:1em}.final-info{font-size:.75em}.cta-button{font-size:1.1em}}
    </style>
</head>
<body>
    <div class="container">
        <h1>💖찰떡궁합은 여기에!💖<br>나와 딱 맞는 이상형과 로테이션 소개팅</h1>
        <p class="catchphrase">“200% 감성 충만 INFP 에겐녀부터 행동력 최강 ESTP 테토남까지” “외모부터 성격까지 다 맞아야 진짜 인연이죠”</p>
        <p class="hook-text">다가오는 빼빼로 데이 때 빼빼로 🎁를 주고받을 수 있는 사람, 필요하지 않으신가요? 외모, 성격, 가치관 빠짐없이 나랑 잘 맞는 반쪽을 찾고 싶으신 분들을 위해 찰떡궁합🍡 설렘 가득한 자리를 마련했어요 🥰</p>
        <h2 class="event-announcement">₊˚ෆ 10월 17일 대망의 로테이션 소개팅 ₊˚ෆ</h2>
        <div class="description">사전 신청해주신 분들께는 나와 이상형의 <b>외모 유형 / MBTI / 에겐-테토 / 가치관</b>을 파악할 수 있는 구글 폼 ✏️을 보내드려요! 저희 AI 알고리즘이 꼼꼼하게 분석해서 최적의 상대를 찾아 매칭해 드립니다.</div>
        <div class="event-details">
            <h2>✨ 행사 정보 ✨</h2>
            <p><strong>일시</strong>: 10월 17일 (금) 19시 ~ 22시</p>
            <p><strong>장소</strong>: 강남역 근처 분위기 좋은 카페</p>
            <p><strong>내용</strong>: 맛있는 커피☕랑 쿠키🍪 먹으며 도란도란 이야기 나누기</p>
            <p><strong>참가비</strong>: 15,900원</p>
            <p><strong>주최</strong>: 진짜 유의미한 소개팅을 하고 싶은 서울대학교 학부생 팀 🎉</p>
        </div>
        <button id="preRegBtn" class="cta-button">사전 신청하고 인연 찾기</button>
        <p class="final-info">행사 3일 전에 장소 및 안내사항 관련 정보를 담은 확정 카톡을 보내드릴 예정이에요! ✨ (신청 시 작성하신 정보는 행사 운영 목적 외에는 절대 사용되지 않으며 행사 종료 후 파기 예정입니다) 많관부 😍</p>
    </div>

    <div id="formModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeForm">&times;</span>
            <h2>사전 신청</h2>
            <p>행사 정보를 가장 먼저 받아보세요!</p>
            
            <form id="preRegForm">
                <input type="text" id="name" name="Name" placeholder="이름" required>
                <select id="gender" name="Gender" required>
                    <option value="" disabled selected>성별</option>
                    <option value="male">남성</option>
                    <option value="female">여성</option>
                </select>
                <input type="number" id="age" name="Age" placeholder="나이 (숫자만 입력)" required>
                <input type="text" id="school" name="School" placeholder="학교" required>
                <input type="email" id="email" name="Email" placeholder="이메일" required>
                <input type="tel" id="phone" name="Phone" placeholder="전화번호 (010-1234-5678)" required>
                
                <div id="photo-upload-area" style="display: none;">
                    <label for="photo" style="display: block; margin-top: 10px; font-size: 0.9em;">본인 사진 업로드 (필수)</label>
                    <input type="file" id="photo" name="Photo" accept="image/*">
                </div>

                <button type="submit" class="cta-button">신청 완료</button>
            </form>
        </div>
    </div>

    <div id="successModal" class="modal">
        </div>

    <script>
        const formModal = document.getElementById('formModal');
        const successModal = document.getElementById('successModal');
        const preRegBtn = document.getElementById('preRegBtn');
        const closeFormBtn = document.getElementById('closeForm');
        const preRegForm = document.getElementById('preRegForm');
        const genderSelect = document.getElementById('gender');
        const photoUploadArea = document.getElementById('photo-upload-area');

        // 성별 선택 시 사진 업로드 필드 보이기/숨기기
        genderSelect.addEventListener('change', function() {
            if (this.value === 'male') {
                photoUploadArea.style.display = 'block';
            } else {
                photoUploadArea.style.display = 'none';
                document.getElementById('photo').value = ''; // 성별 변경 시 파일 선택 초기화
            }
        });

        // 팝업창 열고 닫는 기능
        preRegBtn.onclick = function() {
            formModal.style.display = "block";
            gtag('event', 'pre_register_click', {'event_category': 'registration','event_label': '사전 신청 버튼'});
        }
        closeFormBtn.onclick = function() { formModal.style.display = "none"; }
        window.onclick = function(event) {
            if (event.target == formModal) formModal.style.display = "none";
            if (event.target == successModal) successModal.style.display = "none";
        }

        // 폼 제출 시 동작
        preRegForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const submitButton = preRegForm.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = '처리 중...';

            const fileInput = document.getElementById('photo');
            const file = fileInput.files[0];

            if (genderSelect.value === 'male' && file) {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => sendData({
                    photoData: reader.result,
                    photoName: file.name,
                    photoType: file.type
                });
                reader.onerror = () => {
                    alert('사진 파일을 읽는 데 실패했습니다.');
                    submitButton.disabled = false;
                    submitButton.textContent = '신청 완료';
                };
            } else {
                sendData({});
            }
        });

        function sendData(photoInfo) {
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxLEaWyD5SISk2biQ8Q4ZnXP3XSjBD-BxSWCYUqpiQA6Oi-OuP_1jeNHV5AlhRIncaX/exec'; // 본인 URL 확인!
            const submitButton = preRegForm.querySelector('button[type="submit"]');
            
            const formData = new FormData(preRegForm);
            let data = {};
            formData.forEach((value, key) => data[key] = value);
            data = { ...data, ...photoInfo };

            fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify(data),
                // [핵심 수정] mode: 'no-cors'를 제거하여 정상적인 응답을 기다립니다.
            })
            .then(res => res.json()) // 응답을 JSON 형태로 해석합니다.
            .then(result => {
                console.log('Success!', result);
                if(result.result === 'success') {
                    gtag('event', 'registration_complete', {'event_category': 'registration','event_label': '최종 신청 완료'});
                    formModal.style.display = "none";
                    successModal.style.display = "block";
                    preRegForm.reset();
                    photoUploadArea.style.display = 'none';
                } else {
                    throw new Error(result.error || '알 수 없는 오류가 발생했습니다.');
                }
            })
            .catch(error => {
                console.error('Error!', error.message);
                alert('신청서 제출에 실패했습니다: ' + error.message);
            })
            .finally(() => {
                submitButton.disabled = false;
                submitButton.textContent = '신청 완료';
            });
        }
    </script>
</body>
</html>













